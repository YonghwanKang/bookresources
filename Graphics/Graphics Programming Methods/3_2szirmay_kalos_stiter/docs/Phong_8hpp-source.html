<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>Phong.hpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc2 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>Phong.hpp</h1><a href="Phong_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="preprocessor">#pragma once</span>
00002 <span class="preprocessor"></span>
00003 <span class="preprocessor">#include "<a class="code" href="World_8hpp.html">World.hpp</a>"</span>
00004 
<a name="l00005"></a><a class="code" href="Phong_8hpp.html#a0">00005</a> <span class="preprocessor">#define SpecularAlbedosNum (90)</span>
00006 <span class="preprocessor"></span><span class="comment"></span>
00007 <span class="comment">/*! Lafortune's modified Phong BRDF.</span>
00008 <span class="comment">It satisfies the requirements of symmetry and energy conservation.</span>
00009 <span class="comment">The BRDF is expressed as:</span>
00010 <span class="comment"> </span>
00011 <span class="comment">  brdf(in, out) = kd + ks*pow(cos(a),n)</span>
00012 <span class="comment"> </span>
00013 <span class="comment">  Where:  </span>
00014 <span class="comment">  kd: diffuse coefficient of the BRDF</span>
00015 <span class="comment">  ks: specular coefficient of the BRDF</span>
00016 <span class="comment">  n: specular power</span>
00017 <span class="comment">    n small : glossy reflectance</span>
00018 <span class="comment">    n large : specular reflectance (&gt;= PHONG_LOWEST_SPECULAR_EXP)</span>
00019 <span class="comment">  a: angle between the out direction and the perfect mirror direction for in*/</span>
<a name="l00020"></a><a class="code" href="classCPhongBrdf.html">00020</a> <span class="keyword">class </span><a class="code" href="classCPhongBrdf.html">CPhongBrdf</a> {
00021 <span class="keyword">public</span>: <span class="comment"></span>
00022 <span class="comment"> /*! Kd = kd*pi         or      </span>
00023 <span class="comment">  Ks = ks*2*pi/(n+2)    or      ks = Ks*(n+2)/(2*pi)*/</span><span class="comment"></span>
00024 <span class="comment">        //! diffuse albedo (kd = Kd/pi)</span>
<a name="l00025"></a><a class="code" href="classCPhongBrdf.html#m0">00025</a> <span class="comment"></span>        <a class="code" href="classVector.html">Color</a> <a class="code" href="classCPhongBrdf.html#m0">Kd</a>;
00026 <span class="comment"></span>
00027 <span class="comment">        //! specular albedo (ks = Ks*(n+2)/(2*pi))</span>
<a name="l00028"></a><a class="code" href="classCPhongBrdf.html#m1">00028</a> <span class="comment"></span>    <a class="code" href="classVector.html">Color</a> <a class="code" href="classCPhongBrdf.html#m1">Ks</a>;
00029 <span class="comment"></span>
00030 <span class="comment">        //! diffuse coefficient of the BRDF</span>
<a name="l00031"></a><a class="code" href="classCPhongBrdf.html#m2">00031</a> <span class="comment"></span>        <a class="code" href="classVector.html">Color</a> <a class="code" href="classCPhongBrdf.html#m2">kd</a>;
00032 <span class="comment"></span>
00033 <span class="comment">        //! average BRDF</span>
<a name="l00034"></a><a class="code" href="classCPhongBrdf.html#m3">00034</a> <span class="comment"></span>        <a class="code" href="classVector.html">Color</a> <a class="code" href="classCPhongBrdf.html#m3">avgBrdf</a>;
00035 <span class="comment"></span>
00036 <span class="comment">        //! specular exponent</span>
<a name="l00037"></a><a class="code" href="classCPhongBrdf.html#m4">00037</a> <span class="comment"></span>        <span class="keywordtype">float</span> <a class="code" href="classCPhongBrdf.html#m4">Ns</a>;
00038 <span class="comment"></span>
00039 <span class="comment">        //! average diffuse and specular albedo</span>
<a name="l00040"></a><a class="code" href="classCPhongBrdf.html#m6">00040</a> <span class="comment"></span>        <span class="keywordtype">float</span> <a class="code" href="classCPhongBrdf.html#m5">avgKd</a>, <a class="code" href="classCPhongBrdf.html#m6">avgKs</a>;
00041 <span class="comment"></span>
00042 <span class="comment">        //! pre-processed values</span>
<a name="l00043"></a><a class="code" href="classCPhongBrdf.html#m7">00043</a> <span class="comment"></span>        <span class="keywordtype">float</span> <a class="code" href="classCPhongBrdf.html#m7">specularScaling</a>, <a class="code" href="classCPhongBrdf.html#m8">specularPdfScaling</a>, <a class="code" href="classCPhongBrdf.html#m9">scatteredPower</a>;
00044 <span class="comment"></span>
00045 <span class="comment">        //! evalute the BRDF for the given incoming and outgoing directions</span>
00046 <span class="comment"></span><span class="comment">        /*!</span>
00047 <span class="comment">        @param in points TO the surface</span>
00048 <span class="comment">        @param out points FROM the surface</span>
00049 <span class="comment">        @param normal Normal of the surface at the point</span>
00050 <span class="comment">        */</span>
<a name="l00051"></a><a class="code" href="classCPhongBrdf.html#a0">00051</a>         <a class="code" href="classVector.html">Color</a> <a class="code" href="classCPhongBrdf.html#a0">EvalBrdf</a> (<span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; in, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; out, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; normal) { <span class="keywordflow">return</span> <a class="code" href="classCPhongBrdf.html#a0">EvalBrdf</a>(in, out, normal, normal*in, normal*out); }
<a name="l00052"></a><a class="code" href="classCPhongBrdf.html#a1">00052</a>         <a class="code" href="classVector.html">Color</a> <a class="code" href="classCPhongBrdf.html#a0">EvalBrdf</a> (<span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; in, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; out, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; normal, <span class="keyword">const</span> <span class="keywordtype">float</span> dotNormalIn) { <span class="keywordflow">return</span> <a class="code" href="classCPhongBrdf.html#a0">EvalBrdf</a>(in, out, normal, dotNormalIn, normal*out); }
00053         <a class="code" href="classVector.html">Color</a> <a class="code" href="classCPhongBrdf.html#a0">EvalBrdf</a> (<span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; in, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; out, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; normal, <span class="keyword">const</span> <span class="keywordtype">float</span> dotNormalIn, <span class="keyword">const</span> <span class="keywordtype">float</span> dotNormalOut);
00054 <span class="comment"></span>
00055 <span class="comment">        //! evalute the diffuse BRDF function for the given incoming and outgoing directions</span>
00056 <span class="comment"></span><span class="comment">        /*!</span>
00057 <span class="comment">        @param in points TO the surface</span>
00058 <span class="comment">        @param out points FROM the surface</span>
00059 <span class="comment">        @param normal Normal of the surface at the point</span>
00060 <span class="comment">        */</span>
<a name="l00061"></a><a class="code" href="classCPhongBrdf.html#a3">00061</a>         <a class="code" href="classVector.html">Color</a> <a class="code" href="classCPhongBrdf.html#a3">EvalDiffuseBrdf</a> (<span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; in, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; out, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; normal)       { <span class="keywordflow">return</span> <a class="code" href="classCPhongBrdf.html#a3">EvalDiffuseBrdf</a>(in, out, normal, normal*out);}
00062         <a class="code" href="classVector.html">Color</a> <a class="code" href="classCPhongBrdf.html#a3">EvalDiffuseBrdf</a> (<span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; in, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; out, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; normal, <span class="keyword">const</span> <span class="keywordtype">float</span> dotNormalOut);
00063 <span class="comment"></span>
00064 <span class="comment">        //! evalute the specular BRDF function for the given incoming and outgoing directions</span>
00065 <span class="comment"></span><span class="comment">        /*!</span>
00066 <span class="comment">        @param in points TO the surface</span>
00067 <span class="comment">        @param out points FROM the surface</span>
00068 <span class="comment">        @param normal Normal of the surface at the point</span>
00069 <span class="comment">        */</span>
<a name="l00070"></a><a class="code" href="classCPhongBrdf.html#a5">00070</a>         <a class="code" href="classVector.html">Color</a> <a class="code" href="classCPhongBrdf.html#a5">EvalSpecularBrdf</a> (<span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; in, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; out, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; normal) { <span class="keywordflow">return</span> <a class="code" href="classCPhongBrdf.html#a5">EvalSpecularBrdf</a>(in, out, normal, normal*in, normal*out); }
<a name="l00071"></a><a class="code" href="classCPhongBrdf.html#a6">00071</a>         <a class="code" href="classVector.html">Color</a> <a class="code" href="classCPhongBrdf.html#a5">EvalSpecularBrdf</a> (<span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; in, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; out, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; normal, <span class="keyword">const</span> <span class="keywordtype">float</span> dotNormalIn) { <span class="keywordflow">return</span> <a class="code" href="classCPhongBrdf.html#a5">EvalSpecularBrdf</a>(in, out, normal, dotNormalIn, normal*out); }
00072         <a class="code" href="classVector.html">Color</a> <a class="code" href="classCPhongBrdf.html#a5">EvalSpecularBrdf</a> (<span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; in, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; out, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; normal, <span class="keyword">const</span> <span class="keywordtype">float</span> dotNormalIn, <span class="keyword">const</span> <span class="keywordtype">float</span> dotNormalOut);
00073 
<a name="l00074"></a><a class="code" href="classCPhongBrdf.html#a8">00074</a>         <a class="code" href="classVector.html">Color</a> <a class="code" href="classCPhongBrdf.html#a8">GetDiffuseBrdf</a>() { <span class="keywordflow">return</span> kd; };
<a name="l00075"></a><a class="code" href="classCPhongBrdf.html#a9">00075</a>         <a class="code" href="classVector.html">Color</a> <a class="code" href="classCPhongBrdf.html#a9">GetAverageBrdf</a>() { <span class="keywordflow">return</span> avgBrdf; };
00076 
<a name="l00077"></a><a class="code" href="classCPhongBrdf.html#a10">00077</a>         <a class="code" href="classVector.html">Color</a> <a class="code" href="classCPhongBrdf.html#a10">GetDiffuseAlbedo</a>() { <span class="keywordflow">return</span> Kd; }
<a name="l00078"></a><a class="code" href="classCPhongBrdf.html#a11">00078</a>         <a class="code" href="classVector.html">Color</a> <a class="code" href="classCPhongBrdf.html#a11">GetSpecularAlbedo</a>() { <span class="keywordflow">return</span> Ks; }
00079 
<a name="l00080"></a><a class="code" href="classCPhongBrdf.html#a12">00080</a>         <a class="code" href="classVector.html">Color</a> <a class="code" href="classCPhongBrdf.html#a12">GetAlbedo</a> () { <span class="keywordflow">return</span> Ks+Kd; }
00081 
<a name="l00082"></a><a class="code" href="classCPhongBrdf.html#a13">00082</a>         <span class="keywordtype">float</span> <a class="code" href="classCPhongBrdf.html#a13">GetReflectanceLum</a> () { <span class="keywordflow">return</span> avgKd + avgKs; }
00083 
<a name="l00084"></a><a class="code" href="classCPhongBrdf.html#m10">00084</a>         <a class="code" href="classVector.html">Color</a>   <a class="code" href="classCPhongBrdf.html#m10">specularMaxPhongScaling</a>;
<a name="l00085"></a><a class="code" href="classCPhongBrdf.html#m11">00085</a>         <a class="code" href="classVector.html">Color</a>   <a class="code" href="classCPhongBrdf.html#m11">maxPhongSpecularAlbedos</a>[<a class="code" href="Phong_8hpp.html#a0">SpecularAlbedosNum</a>];
00086 
00087         <a class="code" href="classVector.html">Color</a>   <a class="code" href="classCPhongBrdf.html#a14">ComputedSpecularMaxPhongAlbedo</a>(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; out, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; normal);
00088         <a class="code" href="classVector.html">Color</a>   <a class="code" href="classCPhongBrdf.html#a15">CalculateMaxPhongSpecularAlbedo</a>(<span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; outDir, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; normal);
00089 <span class="comment"></span>
00090 <span class="comment">        //! precalculate values needed for quick evaluation from primary parameters</span>
<a name="l00091"></a><a class="code" href="classCPhongBrdf.html#a16">00091</a> <span class="comment"></span>        <span class="keywordtype">void</span> <a class="code" href="classCPhongBrdf.html#a16">FinishPhong</a> () {
00092                 <span class="comment">// calculate kd</span>
00093                 kd = Kd * <a class="code" href="globals_8hpp.html#a3">M_1_PI</a>;
00094                 avgKd = Kd.<a class="code" href="classVector.html#a28">Average</a> ();
00095                 avgKs = Ks.<a class="code" href="classVector.html#a28">Average</a> ();
00096                 specularScaling = (Ns + 2.0f) / <a class="code" href="globals_8hpp.html#a4">PI2</a>;
00097                 specularPdfScaling = (Ns + 1.0f)  / <a class="code" href="globals_8hpp.html#a4">PI2</a>;
00098                 scatteredPower =  avgKd + avgKs;
00099                 avgBrdf = kd + Ks*(1.0f/<a class="code" href="globals_8hpp.html#a4">PI2</a>);
00100 
00101                 <a class="code" href="classVector.html">Vector</a> surfaceDir(-1.0, 0.0, 0.0);
00102                 <a class="code" href="classVector.html">Vector</a> normal(0.0, 1.0, 0.0);
00103                 <span class="keywordflow">for</span> (<span class="keywordtype">short</span> i = 0; i &lt; <a class="code" href="Phong_8hpp.html#a0">SpecularAlbedosNum</a>; i++) {
00104                         
00105                         <a class="code" href="classVector.html">Vector</a> outDir;
00106                         <span class="keywordtype">float</span> a = ((float)i+0.5f) / (float)<a class="code" href="Phong_8hpp.html#a0">SpecularAlbedosNum</a>;
00107                         outDir=surfaceDir*a + normal * (1.0f - a);
00108                         outDir.<a class="code" href="classVector.html#a20">Normalize</a>();
00109                         maxPhongSpecularAlbedos[i] = <a class="code" href="classCPhongBrdf.html#a15">CalculateMaxPhongSpecularAlbedo</a>(outDir, normal);
00110                 }
00111 
00112         }
00113 
00114 };
00115 <span class="comment"></span>
00116 <span class="comment">//!Phong-type emission distribution function</span>
<a name="l00117"></a><a class="code" href="classCPhongEdf.html">00117</a> <span class="comment"></span><span class="keyword">class </span><a class="code" href="classCPhongEdf.html">CPhongEdf</a> {
00118 <span class="keyword">public</span>:<span class="comment"></span>
00119 <span class="comment">        //! radiance</span>
<a name="l00120"></a><a class="code" href="classCPhongEdf.html#m0">00120</a> <span class="comment"></span>        <a class="code" href="classVector.html">Color</a> <a class="code" href="classCPhongEdf.html#m0">Kd</a>;
00121 <span class="comment"></span>
00122 <span class="comment">        //! radiosity</span>
<a name="l00123"></a><a class="code" href="classCPhongEdf.html#m1">00123</a> <span class="comment"></span>        <a class="code" href="classVector.html">Color</a> <a class="code" href="classCPhongEdf.html#m1">kd</a>;
00124 <span class="comment"></span>
00125 <span class="comment">        //! calculte radiance from radiosity</span>
<a name="l00126"></a><a class="code" href="classCPhongEdf.html#a0">00126</a> <span class="comment"></span>        <span class="keywordtype">void</span> <a class="code" href="classCPhongEdf.html#a0">FinishPhong</a>() {
00127                 Kd = kd * <a class="code" href="globals_8hpp.html#a2">M_PI</a>;
00128         }
00129 <span class="comment"></span>
00130 <span class="comment">        //! multiply radiance with 'patchArea'</span>
<a name="l00131"></a><a class="code" href="classCPhongEdf.html#a1">00131</a> <span class="comment"></span>        <a class="code" href="classVector.html">Color</a> <a class="code" href="classCPhongEdf.html#a1">GetPowerOfArea</a>(<span class="keywordtype">float</span> patchArea) { <span class="keywordflow">return</span> Kd * patchArea; }
00132 <span class="comment"></span>
00133 <span class="comment">        //! return average radiosity along wavelenghts</span>
<a name="l00134"></a><a class="code" href="classCPhongEdf.html#a2">00134</a> <span class="comment"></span>        <span class="keywordtype">float</span> <a class="code" href="classCPhongEdf.html#a2">GetEmissionLum</a>() { <span class="keywordflow">return</span> kd.<a class="code" href="classVector.html#a28">Average</a>();   }
00135         
<a name="l00136"></a><a class="code" href="classCPhongEdf.html#a3">00136</a>         <a class="code" href="classVector.html">Color</a> <a class="code" href="classCPhongEdf.html#a3">GetEmissionRad</a>() { <span class="keywordflow">return</span> kd; }
00137         <span class="comment"></span>
00138 <span class="comment">        //! calculate radiance into a given direction</span>
<a name="l00139"></a><a class="code" href="classCPhongEdf.html#a4">00139</a> <span class="comment"></span>        <a class="code" href="classVector.html">Color</a> <a class="code" href="classCPhongEdf.html#a4">EvalEdf</a> (<span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; out, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; normal) { <span class="keywordflow">return</span> <a class="code" href="classCPhongEdf.html#a4">EvalEdf</a>(out, normal, out*normal); };
<a name="l00140"></a><a class="code" href="classCPhongEdf.html#a5">00140</a>         <a class="code" href="classVector.html">Color</a> <a class="code" href="classCPhongEdf.html#a4">EvalEdf</a> (<span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; out, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; normal, <span class="keyword">const</span> <span class="keywordtype">float</span> dotNormalOut) {
00141                 <span class="keywordflow">if</span> (dotNormalOut&lt;0) <span class="keywordflow">return</span> Color::BLACK;        <span class="comment">// not properly oriented</span>
00142                 <span class="keywordflow">else</span> <span class="keywordflow">return</span> kd; <span class="comment">// add diffuse part only now</span>
00143         }
00144 };
00145 <span class="comment"></span>
00146 <span class="comment">//! This class binds the emission and the reflection characteristic together */</span>
<a name="l00147"></a><a class="code" href="classMaterial.html">00147</a> <span class="comment"></span><span class="keyword">class </span><a class="code" href="classMaterial.html">Material</a> {
00148 <span class="keyword">public</span>:<span class="comment"></span>
00149 <span class="comment">        //! brdf must not be NULL, should always point to a valid brdf function</span>
<a name="l00150"></a><a class="code" href="classMaterial.html#m0">00150</a> <span class="comment"></span>        <a class="code" href="classCPhongBrdf.html">CPhongBrdf</a>*     <a class="code" href="classMaterial.html#m0">m_brdf</a>;
00151 <span class="comment"></span>
00152 <span class="comment">        //! edf may be NULL, if the material is non-emissive</span>
<a name="l00153"></a><a class="code" href="classMaterial.html#m1">00153</a> <span class="comment"></span>        <a class="code" href="classCPhongEdf.html">CPhongEdf</a>*      <a class="code" href="classMaterial.html#m1">m_edf</a>;
00154 
<a name="l00155"></a><a class="code" href="classMaterial.html#a0">00155</a>         <a class="code" href="classMaterial.html#a0">Material</a>() : m_brdf(NULL), m_edf(NULL) {} ;
00156 };
</pre></div><hr><address style="align: right;"><small>Generated on Tue Feb 18 18:30:34 2003 for Stochastic Iteration for Non-diffuse Global Illumination by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc2 </small></address>
</body>
</html>
