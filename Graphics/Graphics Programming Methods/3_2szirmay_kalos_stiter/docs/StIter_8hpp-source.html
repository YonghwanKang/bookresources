<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>StIter.hpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc2 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>StIter.hpp</h1><a href="StIter_8hpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="preprocessor">#pragma once</span>
00002 <span class="preprocessor"></span><span class="preprocessor">#include &lt;windows.h&gt;</span>
00003 <span class="preprocessor">#include &lt;time.h&gt;</span>
00004 
00005 <span class="preprocessor">#include "<a class="code" href="scene_8hpp.html">scene.hpp</a>"</span>
00006 <span class="preprocessor">#include "<a class="code" href="ScreenBuffer_8hpp.html">ScreenBuffer.hpp</a>"</span>
00007 <span class="preprocessor">#include "<a class="code" href="SelectionTree_8hpp.html">SelectionTree.hpp</a>"</span>
00008 <span class="comment"></span>
00009 <span class="comment">//! Stochastic Iteration for Non-diffuse Global Illumination</span>
<a name="l00010"></a><a class="code" href="classStIter.html">00010</a> <span class="comment"></span><span class="keyword">class </span><a class="code" href="classStIter.html">StIter</a>
00011 {<span class="comment"></span>
00012 <span class="comment">        //! pointer to the scene describing patches (triangles),</span>
00013 <span class="comment">        //! materials, lights</span>
<a name="l00014"></a><a class="code" href="classStIter.html#o0">00014</a> <span class="comment"></span>        <a class="code" href="classScene.html">Scene</a>*                          <a class="code" href="classStIter.html#o0">m_pScene</a>;
00015 
00016 <span class="comment"></span>
00017 <span class="comment">        //! ScreenBuffer is responsible for holding the</span>
00018 <span class="comment">        //! calculated result for each pixel of the screen</span>
<a name="l00019"></a><a class="code" href="classStIter.html#o1">00019</a> <span class="comment"></span>        <a class="code" href="classScreenBuffer.html">ScreenBuffer</a>            <a class="code" href="classStIter.html#o1">m_screenBuffer</a>;
00020 <span class="comment"></span>
00021 <span class="comment">        //! ImportanceTree allows fast (log n) selection</span>
00022 <span class="comment">        //! and update for importance-based patch selection</span>
<a name="l00023"></a><a class="code" href="classStIter.html#o2">00023</a> <span class="comment"></span>        <a class="code" href="classImportanceTree.html">ImportanceTree</a>*         <a class="code" href="classStIter.html#o2">m_pImportanceTree</a>;
00024 <span class="comment"></span>
00025 <span class="comment">        //! PowerTree allows fast (log n) selection</span>
00026 <span class="comment">        //! and update for power-based patch selection</span>
<a name="l00027"></a><a class="code" href="classStIter.html#o3">00027</a> <span class="comment"></span>        <a class="code" href="classPowerTree.html">PowerTree</a>*      <a class="code" href="classStIter.html#o3">m_pPowerTree</a>;
00028 <span class="comment"></span>
00029 <span class="comment">        //! maximum number of iteration</span>
<a name="l00030"></a><a class="code" href="classStIter.html#o4">00030</a> <span class="comment"></span>        <span class="keywordtype">long</span>                            <a class="code" href="classStIter.html#o4">m_maxIteration</a>;         
00031 <span class="comment"></span>
00032 <span class="comment">        //! current number of iteration</span>
<a name="l00033"></a><a class="code" href="classStIter.html#o5">00033</a> <span class="comment"></span>        <span class="keywordtype">long</span>                            <a class="code" href="classStIter.html#o5">m_nIteration</a>;
00034 <span class="comment"></span>
00035 <span class="comment">        //! strategy selection probabilities</span>
00036 <span class="comment">        //! m_probPatchSelection_Power+m_probPatchSelection_Importance+m_probPatchSelection_Mix=1.0f</span>
<a name="l00037"></a><a class="code" href="classStIter.html#o6">00037</a> <span class="comment"></span>        <span class="keywordtype">float</span> <a class="code" href="classStIter.html#o6">m_probPatchSelection_Power</a>, 
00038                 <a class="code" href="classStIter.html#o7">m_probPatchSelection_Importance</a>, 
00039                 <a class="code" href="classStIter.html#o8">m_probPatchSelection_Mix</a>;
00040 <span class="comment"></span>
00041 <span class="comment">        //! misc variables for time measuring</span>
<a name="l00042"></a><a class="code" href="classStIter.html#o9">00042</a> <span class="comment"></span>        clock_t <a class="code" href="classStIter.html#o9">time_start</a>, <a class="code" href="classStIter.html#o10">time_end</a>;
<a name="l00043"></a><a class="code" href="classStIter.html#o11">00043</a>         <span class="keywordtype">float</span> <a class="code" href="classStIter.html#o11">duration</a>;
00044 <span class="keyword">public</span>:
00045         <a class="code" href="classStIter.html#a0">StIter</a>(<a class="code" href="classScene.html">Scene</a>* scene, <span class="keywordtype">long</span> iteration, <span class="keywordtype">float</span> power=0.8f, <span class="keywordtype">float</span> importance=0.1f);
00046         <a class="code" href="classStIter.html#a1">~StIter</a>();
00047 <span class="comment"></span>
00048 <span class="comment">        //! rendere image</span>
00049 <span class="comment"></span>        <span class="keywordtype">void</span> <a class="code" href="classStIter.html#a2">render</a>();
00050 <span class="comment"></span>
00051 <span class="comment">        //! save final result</span>
00052 <span class="comment"></span>        <span class="keywordtype">void</span> <a class="code" href="classStIter.html#a3">saveImage</a>();
00053 
00054 
00055 <span class="keyword">private</span>:<span class="comment"></span>
00056 <span class="comment">        //! temporary variable, calculating vertex colors based on patch colors</span>
<a name="l00057"></a><a class="code" href="classStIter.html#o12">00057</a> <span class="comment"></span>        <a class="code" href="classVector.html">Color</a>* <a class="code" href="classStIter.html#o12">m_vertexColors</a>;
00058 <span class="comment"></span>
00059 <span class="comment">        //! for each screen pixel, store the result of an</span>
00060 <span class="comment">        //! eye-visible patch intersection test</span>
<a name="l00061"></a><a class="code" href="classStIter.html#o13">00061</a> <span class="comment"></span>        <a class="code" href="classHitRec.html">HitRec</a>* <a class="code" href="classStIter.html#o13">m_VisibilityInfo</a>;
00062 <span class="comment"></span>
00063 <span class="comment">        //! Determine visibility using special, OpenGL-generated image</span>
00064 <span class="comment"></span>        <span class="keywordtype">void</span> <a class="code" href="classStIter.html#c0">DetermineVisibility</a>();
00065         <span class="keywordtype">bool</span> <a class="code" href="classStIter.html#c1">SetWindowPixelFormat</a>(HDC hDC, DWORD dwFlags, BYTE colorBits);
00066 
00067         <span class="keywordtype">void</span> <a class="code" href="classStIter.html#c2">CalculateDirectLight</a>();
00068         <a class="code" href="classVector.html">Color</a> <a class="code" href="classStIter.html#c3">SampleLightSources</a>(<span class="keyword">const</span> <a class="code" href="classHitRec.html">HitRec</a>&amp; hitRec, <span class="keyword">const</span> <a class="code" href="classRay.html">Ray</a>&amp; ray);
00069 <span class="comment"></span>
00070 <span class="comment">        //! Performs the main iteration step</span>
00071 <span class="comment"></span>        <span class="keywordtype">bool</span> <a class="code" href="classStIter.html#c4">DoIteration</a>();
00072 <span class="comment"></span>
00073 <span class="comment">        //! Does the final scaling of the indirect illumination</span>
00074 <span class="comment"></span>        <span class="keywordtype">void</span> <a class="code" href="classStIter.html#c5">FinalizeLtoEye</a>();
00075 <span class="comment"></span>
00076 <span class="comment">        //! Calculate the average vertex color based on the neighbouring patches' color</span>
00077 <span class="comment"></span>        <span class="keywordtype">void</span> <a class="code" href="classStIter.html#c6">CalculateVertexColors</a>();
00078 <span class="comment"></span>
00079 <span class="comment">        //! OpenGL-Render patches using indirect illumination and add the</span>
00080 <span class="comment">        //! resulting image to the screen buffer</span>
00081 <span class="comment"></span>        <span class="keywordtype">void</span> <a class="code" href="classStIter.html#c7">MergeIndirectOpenGLImage</a>();
00082         <span class="comment"></span>
00083 <span class="comment">        //! OpenGL-Render patches using indirect illumination</span>
00084 <span class="comment"></span>        <span class="keywordtype">void</span> <a class="code" href="classStIter.html#c8">RBOpenGLRenderScene</a>();
00085 <span class="comment"></span>
00086 <span class="comment">        //! Generate a random outgoing direction from the patch based on its radiance</span>
00087 <span class="comment"></span>        <a class="code" href="classVector.html">Vector</a> <a class="code" href="classStIter.html#c9">GenerateRadianceDirection</a>(<span class="keywordtype">long</span> patchIndex, <span class="keywordtype">float</span>&amp; pdf);
00088 <span class="comment"></span>
00089 <span class="comment">        //! Generate a random outgoing direction from the patch based on its importance</span>
00090 <span class="comment"></span>        <a class="code" href="classVector.html">Vector</a> <a class="code" href="classStIter.html#c10">GenerateImportanceDirection</a>(<span class="keywordtype">long</span> patchIndex, <span class="keywordtype">float</span>&amp; pdf);
00091 <span class="comment"></span>
00092 <span class="comment">        //! Generate a valid, normalized specular outgoing direction</span>
00093 <span class="comment"></span>        <a class="code" href="classVector.html">Vector</a> <a class="code" href="classStIter.html#c11">GenerateSpecularDirection</a>(<a class="code" href="classPatch.html">Patch</a>* p, <span class="keywordtype">float</span> value, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; indir, <span class="keywordtype">float</span>&amp; specPdf);
00094 <span class="comment"></span>
00095 <span class="comment">        //! Calculates the radiance of a patch into a specific outgoing direction</span>
00096 <span class="comment"></span>        <a class="code" href="classVector.html">Color</a> <a class="code" href="classStIter.html#c12">getRadiance</a>(<span class="keywordtype">long</span> patchIndex, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; outdir, <a class="code" href="classVector.html">Color</a>&amp; emission);
00097 <span class="comment"></span>
00098 <span class="comment">        //! Calculates the importance of a patch into a specific outgoing direction</span>
00099 <span class="comment"></span>        <span class="keywordtype">float</span> <a class="code" href="classStIter.html#c13">getImportance</a>(<span class="keywordtype">long</span> patchIndex, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; outdir);
00100 <span class="comment"></span>
00101 <span class="comment">        //! Randomized acceptance of the incoming radiance</span>
00102 <span class="comment"></span>        <span class="keywordtype">void</span> <a class="code" href="classStIter.html#c14">Accept</a>(<a class="code" href="classVector.html">Color</a>&amp; _old, <a class="code" href="classVector.html">Color</a>&amp; _new, <a class="code" href="classVector.html">Vector</a>&amp; vOld, <a class="code" href="classVector.html">Vector</a>&amp; vNew, <a class="code" href="classVector.html">Color</a>&amp; Ks );
00103 <span class="comment"></span>
00104 <span class="comment">        //! Randomized acceptance of the incoming importance</span>
00105 <span class="comment"></span>        <span class="keywordtype">void</span> <a class="code" href="classStIter.html#c14">Accept</a>(<span class="keywordtype">float</span>&amp; _old, <span class="keywordtype">float</span>&amp; _new, <a class="code" href="classVector.html">Vector</a>&amp; vOld, <a class="code" href="classVector.html">Vector</a>&amp; vNew);
00106 <span class="comment"></span>
00107 <span class="comment">        //! Calculates the probability of a given outdir, considering specular surface</span>
00108 <span class="comment"></span>        <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="classStIter.html#c16">CalculateSpecularDirectionProbability</a>(<a class="code" href="classPatch.html">Patch</a>* p, <span class="keywordtype">float</span> value, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; indir, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; outdir);
00109         <span class="keyword">inline</span> <span class="keywordtype">float</span> <a class="code" href="classStIter.html#c16">CalculateSpecularDirectionProbability</a>(<a class="code" href="classPatch.html">Patch</a>* p, <span class="keywordtype">float</span> value, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; indir, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; outdir, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; idealReflDir);
00110 <span class="comment"></span>
00111 <span class="comment">        //! Conservative radiance direction probability calculation</span>
00112 <span class="comment"></span>        <span class="keywordtype">float</span> <a class="code" href="classStIter.html#c18">RadianceDirectionProbability</a>(<a class="code" href="classPatch.html">Patch</a>* p, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; outdir);
00113         <span class="keywordtype">float</span> <a class="code" href="classStIter.html#c19">ImportanceDirectionProbability</a>(<a class="code" href="classPatch.html">Patch</a>* p, <span class="keyword">const</span> <a class="code" href="classVector.html">Vector</a>&amp; outdir);
00114 
00115 };
</pre></div><hr><address style="align: right;"><small>Generated on Tue Feb 18 18:30:34 2003 for Stochastic Iteration for Non-diffuse Global Illumination by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc2 </small></address>
</body>
</html>
