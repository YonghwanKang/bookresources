<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>ScreenBuffer.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3-rc2 -->
<center>
<a class="qindex" href="index.html">Main Page</a> &nbsp; <a class="qindex" href="hierarchy.html">Class Hierarchy</a> &nbsp; <a class="qindex" href="classes.html">Alphabetical List</a> &nbsp; <a class="qindex" href="annotated.html">Compound List</a> &nbsp; <a class="qindex" href="files.html">File List</a> &nbsp; <a class="qindex" href="functions.html">Compound Members</a> &nbsp; <a class="qindex" href="globals.html">File Members</a> &nbsp; </center>
<hr><h1>ScreenBuffer.cpp</h1><a href="ScreenBuffer_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre>00001 <span class="preprocessor">#include &lt;stdio.h&gt;</span>
00002 
00003 <span class="preprocessor">#include "screenbuffer.hpp"</span>
00004 
00005 
<a name="l00006"></a><a class="code" href="classScreenBuffer.html#a0">00006</a> <a class="code" href="classScreenBuffer.html#a0">ScreenBuffer::ScreenBuffer</a>()
00007 {
00008         <a class="code" href="classScreenBuffer.html#m2">m_width</a>         = 0;
00009         <a class="code" href="classScreenBuffer.html#m3">m_height</a>        = 0;
00010         <a class="code" href="classScreenBuffer.html#m4">m_nPixel</a>        = 0;
00011         <a class="code" href="classScreenBuffer.html#m0">m_radiance</a>                      = NULL;
00012         <a class="code" href="classScreenBuffer.html#m1">m_rgb</a>                           = NULL;
00013 }
00014 
<a name="l00015"></a><a class="code" href="classScreenBuffer.html#a1">00015</a> <a class="code" href="classScreenBuffer.html#a1">ScreenBuffer::~ScreenBuffer</a>()
00016 {
00017         <span class="keywordflow">if</span> (<a class="code" href="classScreenBuffer.html#m0">m_radiance</a> != NULL)
00018                 <span class="keyword">delete</span>[] <a class="code" href="classScreenBuffer.html#m0">m_radiance</a>;
00019         <span class="keywordflow">if</span> (<a class="code" href="classScreenBuffer.html#m1">m_rgb</a> != NULL)
00020                 <span class="keyword">delete</span>[] <a class="code" href="classScreenBuffer.html#m1">m_rgb</a>;
00021 }
00022 
<a name="l00023"></a><a class="code" href="classScreenBuffer.html#a3">00023</a> <span class="keywordtype">void</span> <a class="code" href="classScreenBuffer.html#a3">ScreenBuffer::Initialize</a>(<a class="code" href="classCamera.html">Camera</a>* pCamera)
00024 {
00025         <a class="code" href="classScreenBuffer.html#m2">m_width</a>         = pCamera-&gt;<a class="code" href="classCamera.html#m9">hres</a>;
00026         <a class="code" href="classScreenBuffer.html#m3">m_height</a>        = pCamera-&gt;<a class="code" href="classCamera.html#m10">vres</a>;
00027         <a class="code" href="classScreenBuffer.html#m4">m_nPixel</a>        = <a class="code" href="classScreenBuffer.html#m2">m_width</a> * <a class="code" href="classScreenBuffer.html#m3">m_height</a>;
00028 
00029         <a class="code" href="classScreenBuffer.html#m0">m_radiance</a>      = <span class="keyword">new</span> <a class="code" href="classVector.html">Color</a> [<a class="code" href="classScreenBuffer.html#m4">m_nPixel</a>];
00030         <a class="code" href="classScreenBuffer.html#m1">m_rgb</a>           = <span class="keyword">new</span> <a class="code" href="Vector_8hpp.html#a0">Color</a> [<a class="code" href="classScreenBuffer.html#m4">m_nPixel</a>];
00031 
00032         <a class="code" href="classScreenBuffer.html#a4">Clear</a> ();
00033 }
00034 
<a name="l00035"></a><a class="code" href="classScreenBuffer.html#a2">00035</a> <span class="keywordtype">void</span> <a class="code" href="classScreenBuffer.html#a2">ScreenBuffer::Syncronize</a>()
00036 {
00037         <span class="keywordflow">for</span>(<span class="keywordtype">long</span> i=0; i&lt;<a class="code" href="classScreenBuffer.html#m4">m_nPixel</a>; i++) {
00038                 <a class="code" href="classScreenBuffer.html#m1">m_rgb</a>[i] = <a class="code" href="classScreenBuffer.html#m0">m_radiance</a>[i];
00039                 <a class="code" href="classScreenBuffer.html#m1">m_rgb</a>[i].<a class="code" href="classVector.html#a4">ClipToUnitInterval</a>();
00040         }
00041 }
00042 
<a name="l00043"></a><a class="code" href="classScreenBuffer.html#a8">00043</a> <span class="keywordtype">bool</span> <a class="code" href="classScreenBuffer.html#a8">ScreenBuffer::saveImage</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>* fname)
00044 {
00045         FILE* file = fopen(fname, <span class="stringliteral">"w+b"</span>);
00046 
00047         <span class="keywordflow">if</span> (file) {
00048                 fputc(0,file);
00049                 fputc(0,file);
00050                 fputc(2,file);
00051                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i=3;i&lt;12;i++) 
00052                         fputc(0,file);
00053                 fputc(m_width&amp;0xff,file);
00054                 fputc(m_width/256,file);
00055                 fputc(m_height&amp;0xff,file);
00056                 fputc(m_height/256,file);
00057                 fputc(24,file);
00058                 fputc(32,file);
00059 
00060                 <span class="keywordflow">for</span>(<span class="keywordtype">int</span> y = 0; y &lt; <a class="code" href="classScreenBuffer.html#m4">m_nPixel</a>; y++ )
00061                 {
00062                         fputc((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)(m_rgb[y].b*255),file);
00063                         fputc((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)(m_rgb[y].g*255),file);
00064                         fputc((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)(m_rgb[y].r*255),file);
00065                 }
00066                 fclose(file);
00067 
00068                 <span class="keywordflow">return</span> <span class="keyword">true</span>;
00069         } <span class="keywordflow">else</span> {
00070                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
00071         }
00072 }
</pre></div><hr><address style="align: right;"><small>Generated on Tue Feb 18 18:30:34 2003 for Stochastic Iteration for Non-diffuse Global Illumination by
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border=0 
width=110 height=53></a>1.3-rc2 </small></address>
</body>
</html>
